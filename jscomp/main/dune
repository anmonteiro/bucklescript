(install
 (section bin)
 (files bsb_helper.exe))

(executable
 (name bsc)
 (public_name bsc.exe)
 (modes native)
 (flags
  (:standard -w -9))
 (libraries js_parser bs_hash_stubs ext common depends super_errors
   outcome_printer core napkin reason)
 (modules_without_implementation jscmj_main)
 (modules bsc jscmj_main))

(rule
 (target bsc.ml)
 (deps
  (:input js_main.ml)
  ../../package.json
  ../../bsconfig.json)
 (action
  (progn
   (system "mkdir -p %{workspace_root}/lib/es6 %{workspace_root}/lib/js")
   (run cppo %{env:CPPO_FLAGS=} %{input} -o %{target}))))

(executable
 (name bspack_main)
 (public_name bspack.exe)
 (modes native)
 (modules bspack_main)
 (flags
  (:standard -w -50))
 (libraries bs_hash_stubs ext common depends unix))

(rule
 (target bsb.ml)
 (deps
  (:input bsb_main.ml))
 (action
  (run cppo %{env:CPPO_FLAGS=} %{input} -o %{target})))

(executable
 (name bsb)
 (public_name bsb.exe)
 (modes native)
 (modules bsb)
 (flags
  (:standard -w -50))
 (libraries bs_hash_stubs ext common bsb))

(executable
 (name cmjdump_main)
 (modes native)
 (modules cmjdump_main)
 (libraries bs_hash_stubs ext common depends core))

(executable
 (name cmij_main)
 (modes native)
 (modules cmij_main)
 (libraries bs_hash_stubs ext common depends core))

(executable
 (name bsb_helper_main)
 (modes native)
 (modules bsb_helper_main)
 (libraries bsb_helper bs_hash_stubs ext common depends core))

(rule
 (target bsb_helper.exe)
 (deps bsb_helper_main.exe)
 (action
  (copy %{deps} %{target})))

(executable
 (name bsb_parse_depend)
 (public_name bsb_parse_depend.exe)
 (modes native)
 (modules bsb_parse_depend)
 (libraries bsb ext))

(test
 (name ounit_tests_main)
 (modes native)
 (modules ounit_tests_main)
 (libraries ounit bs_hash_stubs ext common depends bsb bsb_helper core
   ounit_tests))

(library
 (wrapped false)
 (name builtin_datasets)
 (modules builtin_cmi_datasets builtin_cmj_datasets))
