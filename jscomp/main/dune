(install
 (section bin)
 (files
  bsc.exe
  (bsb_main.exe as bsb.exe)
  (bspack_main.exe as bspack.exe)
  (bsb_helper_main.exe as bsb_helper.exe)))

(executable
 (name js_main)
 (modes native)
 (flags
  (:standard -w -9))
 (libraries js_parser bs_hash_stubs ext common depends super_errors
   outcome_printer core napkin reason)
 (modules_without_implementation jscmj_main)
 (modules js_main jscmj_main))

(rule
 (target bsc.exe)
 (deps
  (:dep js_main.exe)
  ../../package.json
  ../../bsconfig.json)
 (action
  (progn
   ;; here for now because bsc doesn't seem to depend on Unix
   (system "mkdir -p ../../lib/es6 ../../lib/js")
   (copy %{dep} %{target}))))

(executable
 (name bspack_main)
 (modes native)
 (modules bspack_main)
 (flags
  (:standard -w -50))
 (libraries bs_hash_stubs ext common depends unix))

(executable
 (name bsb_main)
 (modes native)
 (modules bsb_main)
 (flags
  (:standard -w -50))
 (libraries bs_hash_stubs ext common bsb))

(executable
 (name cmjdump_main)
 (modes native)
 (modules cmjdump_main)
 (libraries bs_hash_stubs ext common depends core))

(executable
 (name cmij_main)
 (modes native)
 (modules cmij_main)
 (libraries bs_hash_stubs ext common depends core))

(executable
 (name bsb_helper_main)
 (modes native)
 (modules bsb_helper_main)
 (libraries bsb_helper bs_hash_stubs ext common depends core))

(test
 (name ounit_tests_main)
 (modes native)
 (modules ounit_tests_main)
 (libraries ounit bs_hash_stubs ext common depends bsb bsb_helper core
   ounit_tests))

(library
 (wrapped false)
 (name builtin_datasets)
 (modules builtin_cmi_datasets builtin_cmj_datasets))
